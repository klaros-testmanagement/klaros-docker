ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

= Klaros Test Management Docker-Integration
:toc: macro
:sectnums:

image:https://img.shields.io/badge/Version-4.12.3-green.svg[]
image:https://img.shields.io/badge/License-MIT-green[]
image:https://img.shields.io/badge/Community%20Edition-FREE-green[]

toc::[]

== Einführung

IMPORTANT: Diese Dokumentation deckt nur die Klaros Test Management Installation mit der Apache Derby Datenbank ab und wird nur für Testinstallationen unterstützt. Verwenden Sie es nicht für die Produktion.
Die Anleitung für die Produktionsinstallation mit den Datenbanksystemen MariaDB, MySQL und PostgreSQL finden Sie https://github.com/klaros-testmanagement/klaros-docker/blob/master/Documentation.adoc[hier.]

Diese Installationsanleitung zeigt Schritt für Schritt, wie man Klaros Test Management unter Docker für Windows und Linux installiert und konfiguriert.

=== Über Docker
https://www.docker.com/[Docker] ist eine kostenlose, containerbasierte Software, die eine sichere Installation von Anwendungen auf verschiedenen Betriebssystemen wie Windows und Linux ermöglicht.

Weitere Informationen finden Sie unter https://www.docker.com/why-docker[Why-Docker]

=== Über Klaros-Testmanagement

Klaros-Testmanagement ist eine professionelle webbasierte Testmanagement-Software. Es enthält Komponenten für das Ressourcenmanagement und die Auswertung der Testaktivität. Die Verfolgung von Testanforderungen wird ebenso unterstützt wie agile Entwicklungsprozesse. Zahlreiche Schnittstellen zu Issue Trackern, Testautomatisierungstools und Kontinuierlichen Integrationsservern ermöglichen eine nahtlose Integration in bestehende Entwicklungsumgebungen.

Klaros-Testmanagement ist in der Community Edition kostenlos verfügbar.

Die Community Edition ist uneingeschränkt nutzbar und verfügt über einen reduzierten Funktionsumfang.

Ohne Begrenzung der Anzahl von Projekten, Testfällen oder Benutzern ist es ideal für den Einstieg in ein kleines Team.

Sie können die Community Edition jederzeit auf die Enterprise Edition aktualisieren, indem Sie eine Lizenzdatei hochladen.

Die Enterprise Edition bietet Ihnen den vollen Funktionsumfang, inklusive einjährigem Support und kostenlosem Zugriff auf alle Software-Updates. Schauen Sie sich https://www.klaros-testmanagement.com/en_US/test-management/test-management-tool-comparison[hier] den Vergleich der Community und Enterprise Edition an.

Um Ihre kostenlose 30-tägige Testlizenz für die Enterprise Edition zu erhalten, können Sie https://www.klaros-testmanagement.com/en_US/trial[hier] Ihren Lizenzschlüssel anfordern.

Weitere Informationen finden Sie unter https://www.klaros-testmanagement.com/en_US/[Klaros Test Management.]

== Voraussetzungen

.Windows
[%collapsible]
====

Die aktuellen Hardwareanforderungen und Installationsschritte sind in der https://docs.docker.com/docker-for-windows/install/[offiziellen Docker-Dokumentation] beschrieben. Für die Installation von Docker Desktop ist eine Anmeldung erforderlich.

Um die spätere Aktualisierung von Klaros Test Management zu erleichtern, wird empfohlen, das Dockerfile mit Git von GitHub herunterzuladen.
Git kann von der https://git-scm.com[offiziellen Webseite] heruntergeladen und installiert werden.

Während der Installation kann ausgewählt werden, ob und wie die Zeilenendungen von Dateien konvertiert werden soll. Da der Server innerhalb des Containers über Linux betrieben wird, und sich die Zeilenendungen von Windows (\r) und Linux (\n) unterscheiden, empfehlen wir die Option „Checkout as-is, commit Unix-style line endings“ oder „Checkout as-is, commit as-is“ auszuwählen.

.Konfiguration der Zeilenenden-Konvertierung
image::images/ConfigurationOfTheLineEndConversion.png[Konfiguration der Zeilenenden-Konvertierung]

Damit sind die Vorbereitungen für Windows abgeschlossen. Im Kapitel „Download des Dockerfiles von Klaros-Testmanagement über GitHub“ wird beschrieben, wie das Dockerfile mithilfe von Git Bash heruntergeladen und für zukünftige Updates vorbereitet werden kann.
====

.Linux
[%collapsible]
====

Auf der offiziellen Docker-Dokumentation sind die aktuellen Hardwareanforderungen und Installationsschritte zu finden.

https://docs.docker.com/install/linux/docker-ce/ubuntu/[Ubuntu Docker]

https://docs.docker.com/install/linux/docker-ce/debian/[Debian Docker]

https://docs.docker.com/install/linux/docker-ce/centos/[CentOS Docker]

https://www.cyberciti.biz/faq/install-use-setup-docker-on-rhel7-centos7-linux/[RHEL Docker]

Unter CentOS und RHEL ist Podman eine beliebte Alternative gegenüber Docker. Da Podman ähnliche Funktionen wie Docker zur Verfügung stellt, müssen die Codeabschnitte mit „docker“ lediglich durch „podman“ ersetzt werden.

Unterstützte https://podman.io/getting-started/installation.html[Podman]-Version: 1.4.4

https://git-scm.com/[Git] is required to successfully download the Klaros Test Management Dockerfile from GitHub.

.Git-Installation über Ubuntu/Debian:
----
sudo apt-get update
sudo apt-get install git
----

.Git-Installation über CentOS/RHEL:
----
sudo yum check-update
sudo yum install git-core
----


Ob die Installation erfolgreich war, lässt sich mit folgendem Kommando überprüfen:
----
git --version
Output: git version 2.20.1
----

Damit sind die Vorbereitungen für Linux abgeschlossen. Im Kapitel „Download des Dockerfiles von Klaros-Testmanagement über GitHub“ wird beschrieben, wie das Dockerfile heruntergeladen und für zukünftige Updates vorbereitet werden kann.
====

== Docker-Umgebungsvariablen konfigurieren

.Konfigurierbare Umgebungsvariablen vor dem ersten Serverstart über das Dockerfile
[options="header"]
|=======================
|Variable |Voreinstellung |Beschreibung
|TOMCAT_ADMIN_PASSWORD       |P@ssw0rd  Passwort für den Login auf 127.0.0.1:18080/monitoring
|TOMCAT_MEMORY_MIN           |128       |Minimal verfübarer Arbeitsspeicher in MB
|TOMCAT_MEMORY_MAX           |768       |Maximal verfügbarer Arbeitsspeicher in MB
|JAVA_OPTS  |  | Mit JAVA_OPTS können zusätzliche Einstellungen an den Tomcat-Server übertragen werden. Beispielsweise kann die Zeitzone mit JAVA_OPTS -Duser.timezone=Europe/Berlin auf Europa/Berlin eingestellt werden.
|KLAROS_VERSION         |${KLAROS_VERSION:-4.12.1} |Klaros-Release-Version, die während der Installation verwendet wird.  Eine Liste der verfügbaren Releases finden Sie auf der offiziellen https://www.klaros-testmanagement.com/en_US/download[Klaros-Testmanagement] Webseite oder auf https://github.com/klaros-testmanagement/klaros-docker/releases[GitHub]
|=======================

.Veränderbare Variablen nach dem ersten Serverstart über das Dockerfile
[options=""]
|=======================
|TOMCAT_MEMORY_MAX
|TOMCAT_MEMORY_MIN
|JAVA_OPTS
|=======================

=== Konfiguration über das Dockerfile

Öffne das Dockerfile unter _~/klaros-docker/ApacheDerby_ mit dem bevorzugten Texteditor. das Dockerfile enthält eine Liste der konfigurierbaren ENV-Variablen. Weitere Informationen finden Sie in Tabelle 1.

NOTE: Bitte stellen Sie sicher, dass Sie das Image nach dem Ändern des Dockerfiles neu erstellen.

=== Konfiguration beim Serverstart

Changeable variables can be found in Table 2. The environment variables can be changed with the -e parameter.

.Beispiel
----
sudo docker run --name Klaros -p 18080:18080 -e TOMCAT_MEMORY_MAX='1024' -e <Weitere Variable> klaros
----

=== Konfiguration über eine Datei

Um die Konfigurationen über eine Datei festzulegen, kann im ApacheDerby Verzeichnis eine Textdatei erstellt werden.
Modifizierbare Variablen finden Sie in Tabelle 2. Fügen Sie beim Erstellen des Containers den Parameter --env-file hinzu.

.Windows Beispiel
[%collapsible]
====
----
New-Item <Path/env-list.txt> -ItemType file
echo "TOMCAT_MEMORY_MAX=1024" > env-list.txt
sudo docker create --name Klaros -p 18080:18080 --env-file ./env-list.txt klaros
----
====

.Linux Beispiel
[%collapsible]
====
----
touch env-list
echo "TOMCAT_MEMORY_MAX=1024" > env-list
docker create --name Klaros -p 18080:18080 --env-file ./env-list klaros
----
====

== Installation
=== Clone
Sobald Sie sich in dem gewünschten Verzeichnis befinden, können Sie das Dockerfile herunterladen.
----
git init
git clone https://github.com/klaros-testmanagement/klaros-docker 
----

Mit „ls“ können Sie überprüfen, ob das Verzeichnis korrekt erstellt wurde.
----
ls
Ausgabe: klaros-docker
----

=== Build
Das Image wird benötigt, um den Klaros-Container zu erstellen und den Server zu starten. +
Windowsnutzer wechseln von Git Bash zur Powershell.

----
cd ~/klaros-docker/ApacheDerby
docker build -t klaros .
----

== Benutzung
=== So starten Sie eine Instanz

Beim Starten wird ein Docker-Container mit dem Namen „Klaros“ angelegt.

IMPORTANT: Beim Erstellen des Containers wird ein anonymes Volume erstellt. Wenn ein benanntes Volume gewünscht wird, muss -v als zusätzlicher Parameter hinzugefügt werden.

.One-time execution: Create a Klaros container (anonymous volume)
----
docker create --name Klaros -p 18080:18080 klaros
----

.One-time execution: Create a Klaros container (named volume)
----
docker create --name Klaros -p 18080:18080 -v klaros-data:/data klaros
----

.Once the container has been created, the server can be booted with "docker start".
----
docker start -a Klaros
----

.To execute the container in detached mode, the -a parameter must be removed.
----
docker start Klaros
----

[%collapsible]
====
You can find further information in the https://docs.docker.com/engine/reference/commandline/start/[official Docker Documentation.]

After the server has been started, the message "Server startup in x ms" appears at the end. You can now use any browser to enter your IP address and port to access the Klaros website.

----
Username: admin
Password: admin
----

Example: 127.0.0.1:18080

====

Another Klaros instance can be used to check backups for completeness or to test a newer Klaros version.
To create another instance, simply change the containername and port.

.Create a second Klaros instance with its own database
----
docker create --name Klaros2 -p 18081:18080 klaros
----

=== How to shut down your instance

In detached mode, the server must be shut down via "docker stop".
If the container has been started in the foreground, press CTRL + C to return to the terminal and shut down the container automatically. Windows is considered as an exception and the container must be closed via "docker stop".

----
docker stop Klaros
----

== Create, restore and test a backup
Backups are labeled with the name "backup_klaros<date>.tar.gz". If you create several backups per day, it is recommended to specify a time (hours, minutes and seconds) when creating the backups. To do this, add %H(hour), %M(minute), and %S(second) in date/Get-Date.

If an error occurs while creating the backup, the log file provides useful hints.

.Windows Example
----
$(Get-Date -UFormat "%y-%m-%d-%Hh-%Mm-%Ss")
----

.Linux Example
----
$(date '+%y-%m-%d-%H:%M:%S')
----

[%collapsible]
====
This would give the backup the following name:

Windows: backup_klaros19-10-28-11h-34m-33s.tar.gz +
Linux: backup_klaros19-10-28-11:34:33.tar.gz

You can change the backup path using the code section behind -v: "~/klaros-docker/backup"

.Windows Example
----
mkdir ~/klaros-docker/Path/backup
docker run --rm --volumes-from Klaros -v ~/klaros-docker/Path/backup:/backup alpine tar cvzf /backup/backup_klaros$(Get-Date -UFormat "%y-%m-%d").tar.gz /data/klaros-home /data/catalina-base/logs
----

.Linux Example
----
mkdir ~/klaros-docker/Path/backup
sudo docker run --rm --volumes-from Klaros -v ~/klaros-docker/Path/backup:/backup alpine tar cvzf /backup/backup_klaros$(date '+%y-%m-%d').tar.gz /data/klaros-home /data/catalina-base/logs
----
====

=== Creating a backup

.Windows
----
docker stop Klaros
mkdir ~/klaros-docker/backup
docker run --rm --volumes-from Klaros -v ~/klaros-docker/backup:/backup alpine tar cvzf /backup/backup_klaros$(Get-Date -UFormat "%y-%m-%d").tar.gz /data/klaros-home /data/catalina-base/logs
docker start -a Klaros
----

.Linux
----
sudo docker ps
sudo docker stop Klaros
sudo docker run --rm --volumes-from Klaros -v ~/klaros-docker/backup:/backup alpine tar cvzf /backup/backup_klaros$(date '+%y-%m-%d').tar.gz /data/klaros-home /data/catalina-base/logs
sudo docker start -a Klaros
----

=== Restore a Backup

.Note to adjust the date of the respective backups.
----
docker stop Klaros
docker run --rm --volumes-from Klaros -v ~/klaros-docker/backup:/backup alpine /bin/sh -c "cd /data && tar xvzf /backup/backup_klaros19-10-28.tar.gz --strip 1"
docker start -a Klaros
----

=== Test a Backup

To test a backup, you can create a second Klaros instance to play the backup on. The second instance must be fully booted once before the backup can be installed.

----
docker run --name Klaros-test -p 18081:18080 klaros
----

The server is then stopped with CTRL + C or with "docker stop".
----
docker stop Klaros-test
----

.Note to adjust the date of the respective backups.
----
docker run --rm --volumes-from Klaros-test -v ~/klaros-docker/backup:/backup alpine /bin/sh -c "cd /data && tar xvzf /backup/backup_klaros19-10-28.tar.gz --strip 1"
docker start -a Klaros-test
----

If the backup has been successfully tested, the server can be stopped and removed.
----
docker stop Klaros-test
docker rm -v Klaros-test
----

== How and where can I find the log files?

Log files may be required for troubleshooting. To access log files, a shell can be opened directly in the Docker-Container or they can be taken from the backup.

Relevant log files can be found here:

_/data/catalina-base/logs_

=== Show log files via Docker shell
Open a shell with "docker exec" in the Klaros container to get access to the logs.

NOTE: Please note that the server must be started when accessing via the shell and is not shut down.

.The log files can then be read using more
----
docker exec -it Klaros /bin/sh
more /data/catalina-base/logs/catalina.2019-12-09.log
----

=== Show logs from backup

.Windows
[%collapsible]
====
Windows users can use the https://www.winrar.de/downld.php[WinRAR] archive program to extract .tar.gz archives.

Afterwards, the Klaros Test Management logs can be displayed in the "logs" folder of catalina-base.
====

.Linux
[%collapsible]
====
To read the logs from the backup, use tar to unpack the archive.
----
sudo tar -xzf backup_klaros19-10-28.tar.gz
----

Afterwards, the Klaros Test Management logs can be displayed in the "logs" folder of catalina-base.
====

== Update

IMPORTANT: If the update is only for testing purposes, do not use its original branch (klaros or master), otherwise the configurations for the previous version will be lost(You can clone the directory for this). Also make sure to use a different volume and rebuild the old image with "docker-compose build" after testing, so that your original version is not accidentally updated.

Before an update of Klaros Test Management is executed, a temporary container with the volumes of Klaros must be created.

----
docker stop Klaros
docker create --name Klaros-tmp --volumes-from Klaros alpine
docker rm Klaros
----

=== Update via master branch

Klaros can be updated to the latest version with "git pull".
----
git pull origin master
----

=== Update via tags

To perform an update from an older to a newer version, the first step is to check for new updates in the GitHub repository. Current versions can be displayed via "git tag". Then a local branch "update" with the desired version can be created and merged. Alternatively, you can merge your local branch directly with the master instead of creating a second branch.
----
git checkout master
git pull origin master
git checkout tags/<tag_name> -b update
git checkout klaros
git merge update
git branch -D update
----

=== Refresh image

After downloading the update from the Git repository, the next step is to remove the old image and create a new one.
----
docker rmi klaros
docker build -t klaros .
----

After the new image has been created, the server will be created with the volumes of Klaros-tmp and the temporary container will be removed. Afterwards the server can be started as usual.
----
docker create --name Klaros --volumes-from Klaros-tmp -p 18080:18080 klaros
docker rm Klaros-tmp
docker start -a Klaros
----

== How to use a previous version

NOTE: If a newer version is already in use, then an older version can only be used by creating a new instance or a re-installation.

You can view currently supported versions on https://github.com/klaros-testmanagement/klaros-docker/releases[GitHub releases].

After the repository has been cloned, the tags can be listed with "git tag" and selected as local branch with "git checkout".

----
git tag
git checkout tags/<tag_name> -b klaros
----

== Uninstallation

To completely remove Klaros Test Management from Docker, the container must be stopped first, before the container and volume can be removed.

Then remove the _~/klaros-docker_ directory and the image.
----
docker stop Klaros
docker rm -v Klaros
docker rmi klaros
rm -rf ~/klaros-docker
----

== Documentation

To get started with Klaros Test Managment please refer to our https://www.klaros-testmanagement.com/files/tutorial/html/Tutorial.index.html[tutorial] and the https://www.klaros-testmanagement.com/files/doc/html/User-Manual.index.html[user manual.] Both are also available in the application itself after a successful login.

Our installation documentation includes the installation of Klaros Test Management under Docker for Apache Derby, MariaDB, MySQL and PostgreSQL databases.

== FAQ

If you have further questions about Klaros Test Management and the Enterprise Edition, do not miss our https://www.klaros-testmanagement.com/en_US/faq?inheritRedirect=true[Pricing-FAQ] and https://www.klaros-testmanagement.com/en_US/support?inheritRedirect=true[Support-FAQ.]

== License
Klaros Test Management for Docker is licensed under the terms of the https://github.com/klaros-testmanagement/klaros-docker/blob/master/LICENSE[MIT License.]

By installing our software through Docker, you also agree to our https://www.klaros-testmanagement.com/files/current/LICENSE.txt[Limited Use Software License Agreement.]

== Contact

We thank you for your attention and hope to meet the interests of many users with this documentation. We are continuously working on improving Klaros Test Management.

So if you have any questions or requests or simply want to give feedback, please write to us at support@verit.de oder use our https://www.klaros-testmanagement.com/en_US/forum[User Forum.]

== Acknowledgements

* https://github.com/tuxknowledge[André Raabe] for providing the https://github.com/akaer/Dockerfiles/tree/master/klaros[Apache Derby and Microsoft SQL Server Version]
